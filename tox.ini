[tox]
envlist =
    lint,
    py{27,36,38,310}-ansible_v{28,29,51,61},
    coveralls
skip_missing_interpreters = true

[gh-actions]
python =
    2.7: py27
    3.6: py36
    3.8: py38
    3.10: py310

[gh-actions:env]
ANSIBLE_VERSION =
    v28: ansible_v28
    v29: ansible_v29
    v51: ansible_v51
    v61: ansible_v61

[testenv]
# The following does not work properly ... demons
# commands = py.test -v --tb=native --doctest-glob='*.md' --cov=pytest_ansible {posargs}
# commands = python setup.py test --pytest-args "{posargs}"
commands =
    coverage run --parallel --source pytest_ansible -m pytest -v --doctest-glob='*.md' {posargs}
    coverage combine
    coverage report -m
passenv = ANSIBLE_DEBUG TRAVIS TRAVIS_JOB_ID TRAVIS_BRANCH
setenv =
    ANSIBLE_REMOTE_TEMP = {envdir}/.ansible-remote
    ANSIBLE_LOCAL_TEMP = {envdir}/.ansible-local
    # ANSIBLE_SSH_PIPELINING = 1
deps =
    -r{toxinidir}/test-requirements.txt

[testenv:lint]
commands =
    py.test pytest_ansible --pylama {posargs}
    coverage erase

[testenv:coveralls]
commands=
    - coveralls

[testenv:ansible_v28]
deps =
    {[testenv]deps}
    ansible>=2.8.0,<2.9.0

[testenv:ansible_v29]
deps =
    {[testenv]deps}
    ansible>=2.9.0,<2.10.0

[testenv:ansible_v51]
deps =
    {[testenv]deps}
    ansible>=5.1.0,<5.2.0

[testenv:ansible_v61]
deps =
    {[testenv]deps}
    ansible>=6.1.0,<6.2.0

[pytest]
minversion = 4.2
maxversion = 5.4.3
addopts = -v --tb=native
markers =
    old
    unit
    ansible_v1_xfail
    requires_ansible_v1
    requires_ansible_v2
    requires_ansible_v24

[pylama]
format = pylint
skip = */.tox/*,*/.env/*
linters = mccabe,pep8,pyflakes,pydocstyle,pycodestyle
ignore = F0401,C0111,E731,D100,W0621,W0108,R0201,W0401,W0614,W0212,C901,R0914,I0011,D211,D102,D213

[pylama:pep8]
max_line_length = 120

[pylama:pylint]
max_line_length = 120
additional_builtins = config,self,item,skip

[pylama:mccabe]
max_complexity = 11

[pylama:pycodestyle]
max_line_length = 120
max-line-length = 120
